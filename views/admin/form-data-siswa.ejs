<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../../assets/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../../assets/css/data-siswa.css" />
    <script src="https://kit.fontawesome.com/66d4c07337.js" crossorigin="anonymous"></script>
    <title>Document</title>
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <div class="row justify-content-center align-items-center">
            <div class="col">
              <img src="../../assets/img/logo.png" alt="" width="60px" height="auto" class="align-text-top" />
            </div>
            <div class="col">
              <div class="text">Sistem Ujian Online</div>
              <div class="text">SMKN 4 MALANG</div>
            </div>
          </div>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse text-center navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="/admin/tambah-jurusan?attribute=all">Data Jurusan</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="/admin/tambah-kelas?attribute=all">Data Kelas</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="/admin/tambah-mapel?attribute=all">Data Mapel</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/admin/siswa/data?attribute=all">Data Siswa</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/ujian/jadwal?attribute=all">Data Ujian</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="/admin/guru/data?attribute=all">Data Nilai</a>
            </li>
            <li class="nav-item ps-3 pe-3">
              <div class="dropstart profil">
                <a class="" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false"> <img src="../../assets/img/default.png" alt="" /> </a>

                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                  <li><a class="dropdown-item disabled" href="#">Profile</a></li>
                  <li><a class="dropdown-item" href="/log/out">Logout</a></li>
                </ul>
              </div>
            </li>

            <!-- <li class="nav-item">
              <a class="nav-link" aria-current="page" href="data-guru.html">Data Guru</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="tambah-ujian.html">Data Ujian</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="data-siswa.html">Data Siswa</a>
            </li>
            </li>
          
            <li class="nav-item ps-3 pe-3">
              <div class="dropstart profil">
                <a class="" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false"> <img src="../../assets/img/default.png" alt="" /> </a>

                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                  <li><a class="dropdown-item disabled" href="#">Profile</a></li>
                  <li><a class="dropdown-item" href="#">Logout</a></li>
                </ul>
              </div>
            </li> -->
          </ul>
        </div>
      </div>
    </nav>
    <!-- Akhir Navbar -->

    <div class="container-fluid">
      <!-- <style>
        .col-lg-6 {
          border: solid 1px black;
        }
      </style> -->
      <div class="row">
        <% if( query.manual == 'true' ) { %>
          <div class="col-lg-6 manual">
            <div class="row mt-5">
              <div class="row">
                <div class="col text-dark text-center mb-5">
                  <h3>Tambah Data Siswa</h3>
                </div>
              </div>
              <div class="container-fluid">
              <form action="/admin/siswa/tambah?manual=true&imp=false" method="POST">
                <div class="row lg-2">
                  <div class="col-lg-3 offset-lg-1">
                  </div>
                  <div class="col-lg-6">
                    <%- include('./../partials/message.ejs') %>
                  </div>
                </div>
                <!-- Nama -->
                <div class="row lg-2">
                  <div class="col-lg-3 offset-lg-1">
                    <h5>Nama Siswa</h5>
                  </div>
                  :
                  <div class="col-lg-6">
                    <div class="input-group input-group-sm">
                      
                      <input required type="text" name="nama" class="form-control rounded-3" aria-describedby="inputGroup-sizing-sm" />
                    </div>
                  </div>
                </div>
      
                <!-- NIS -->
                <div class="row mt-2">
                  <div class="col-lg-3 offset-lg-1">
                    <h5>NIS</h5>
                  </div>
                  :
                  <div class="col-lg-6">
                    <div class="input-group input-group-sm">
                      
                      <input required type="text" name="nis" autocomplete="off" class="form-control rounded-3" aria-describedby="inputGroup-sizing-sm" />
                    </div>
                  </div>
                </div>
      
                <!-- Kelas -->
                <div class="row mt-2">
                  <div class="col-lg-3 offset-lg-1">
                    <h5>Kelas</h5>
                  </div>
                  :
                  <div class="col-lg-6">
                    <div class="input-group input-group-sm">
                      <select name="kelas" class="form-control" id="kelas">
                        <option value="" hidden>Pilih Kelas</option>
                        <% data.forEach(x => { %>
                          <option value="<%= x.tingkat %>/<%= x.jurusan %>/<%= x.kelas %>"><%= x.tingkat %> <%= x.jurusan %> <%= x.kelas %></option>
                        <% }) %>
                      </select>
                      <!-- <input type="text" class="form-control rounded-3" aria-describedby="inputGroup-sizing-sm" /> -->
                    </div>
                  </div>
                </div>
      
                  <!-- Username -->
                  <!-- <div class="row lg-2 mt-2">
                    <div class="col-lg-3 offset-lg-1">
                      <h5>Username</h5>
                    </div>
                    :
                    <div class="col-lg-6">
                      <div class="input-group input-group-sm">
                        
                        <input type="text" class="form-control rounded-3" aria-describedby="inputGroup-sizing-sm" />
                      </div>
                    </div>
                  </div> -->
  
                   <!-- Password -->
                   <!-- <div class="row lg-2 mt-2">
                    <div class="col-lg-3 offset-lg-1">
                      <h5>Password</h5>
                    </div>
                    :
                    <div class="col-lg-6">
                      <div class="input-group input-group-sm">
                        
                        <input type="text" class="form-control rounded-3" aria-describedby="inputGroup-sizing-sm" />
                      </div>
                    </div>
                  </div> -->
  
  
                <!-- button -->
                <div class="row mt-4 mb-3">
                  <div class="col-lg-10">
                    <div class="d-grid justify-content-md-end">
                      <button type="submit" class="btn btn-primary">Tambah</button>
                      <a href="">
                      </a>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            </div>
          </div>
        <% } %>
  
        <!-- impor data siswa -->
  
        <% if( query.imp == 'true' ) { %>
          <div class="col-lg-6">
            <div class="row mt-5">
              <div class="row">
                <div class="col text-dark text-center mb-5">
                  <h3>Import Data Siswa</h3>
                </div>
              </div>
              <form action="/admin/siswa/tambah?manual=false&imp=true" method="POST">
                <!-- nama file -->
                <div class="container-fluid import-inp">
                  
                  <!-- <input class="form-control mt-3" name="excel" required type="file" id="formFile"> -->

                  <div class="input-group">
                    <input type="file" name="excel" required class="form-control" id="formFile" aria-describedby="inputGroupFileAddon04" aria-label="Upload">
                    <button class="btn btn-outline-primary" type="submit" id="inputGroupFileAddon04">Tambah</button>
                  </div>

                  <div class="alert alert-danger alert-fileType" style="margin-top:10px; display: none;" role="alert">
                    Format yang anda upload bukan Excel!
                  </div>

                  <div class="col-lg-6" style="width: 100%; overflow-y: scroll; height: 30vh;">
                    <table class="table table-convert mt-5">
                      <thead class="" style="background-color: #0d6efd;; color: white">
                        <tr style="white-space: nowrap;">
                          <th scope="col" style="width: 50%;">Nama Siswa</th>
                          <th scope="col" style="width: 35%;">NIS</th>
                          <th scope="col" style="width: 15%;">Kelas</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td colspan="3" style="text-align: center;">Data tidak terdeteksi</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <!-- button -->
                  <div class="row mt-4 mb-3">
                    <div class="col align-self-end">
                      <div class="d-grid justify-content-md-end">
                        <a href="">
                        </a>
                        <button type="submit" class="btn btn-primary">Tambah</button>
                      </div>
                    </div>
                  </div>
                </div>
      
              </form>
            </div>
          </div>
        <% } %>
      </div>
    </div>
    <!-- /Content -->

    <footer>
      <div class="footer mt-5">
        <div class="container pt-4">
          Copyright 2022
        </div>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/5538402706.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/read-excel-file@4.1.0/bundle/read-excel-file.min.js"></script>
    <script src="../../converter/xlsToJson.js"></script>
  </body>
  <script>
    let ttFormat = [ "Nama", "NIS", "Kelas", "Jurusan", "Kode Kelas", ]
    document.querySelector('#formFile').addEventListener('change', function(e) {
      document.querySelector('.alert-fileType').style.display = 'none'
      if( this.files[0].type == "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" ) {
        readXlsxFile(this.files[0]).then(xls => {
          if( xls[0].length != ttFormat.length ) {
            document.querySelector('.alert-fileType').style.display = 'block'
            return document.querySelector('.alert-fileType').innerText = 'Format judul tidak lengkap'
          }
          for( let i = 0; i < ttFormat.length; i++ ) {
            if( xls[0][i].toUpperCase() != ttFormat[i].toUpperCase() ) {
              document.querySelector('.alert-fileType').style.display = 'block'
              return document.querySelector('.alert-fileType').innerText = `${xls[0][i]} pada file seharusnya ${ttFormat[i]}`
            }
          }

          xls.shift()
          document.querySelector('.table-convert tbody').innerHTML = ''
          return xls.forEach(x => {
            document.querySelector('.table-convert tbody').innerHTML += `
                        <tr>
                          <td style="width: 50%;"><input type="text" name="nama" value="${x[0]}"></td>
                          <td style="width: 35%;"><input type="text" name="nis" value="${x[1]}"></td>
                          <td style="width: 15%;"><input type="text" name="kelas" value="${x[2]} ${x[3]} ${x[4]}"></td>
                        </tr>
            `
          })
        }).catch(err => console.log(err))
      } else document.querySelector('.alert-fileType').style.display = 'block'
    })
  </script>
</html>
